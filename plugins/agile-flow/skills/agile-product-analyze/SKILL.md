---
name: agile-product-analyze
description: 产品需求分析技能：分析PRD、评估优先级、创建任务、维护项目业务上下文
version: 5.0.0
---

# Agile Product Analyze - 产品需求分析

## 任务

1. 分析项目需求文档（PRD），评估优先级，创建任务到 `ai-docs/TASKS.json`
2. 维护项目业务上下文 `ai-docs/CONTEXT.md`

---

## 环境变量

**必须设置**：
```bash
export AI_DOCS_PATH="$(pwd)/ai-docs"
```

---

## 执行流程

### 第一步：读取现有上下文

**优先读取 `ai-docs/CONTEXT.md`**，了解项目当前状态。

### 第二步：读取 PRD

读取 `ai-docs/PRD.md` 文件，识别核心功能需求。

### 第三步：评估优先级

使用优先级评估脚本：
```bash
bash ${CLAUDE_PLUGIN_ROOT}/scripts/utils/priority-evaluator.sh
```

**优先级评估规则**：

| 优先级 | 说明 | 关键词 |
|--------|------|--------|
| **P0** | 关键任务 | 紧急、关键、核心、阻塞、崩溃、安全、漏洞 |
| **P1** | 高优先级 | 重要、优化、性能、体验、提升、改进 |
| **P2** | 中等优先级 | 默认优先级 |
| **P3** | 低优先级 | 可选、建议、美化、调整、微调 |

### 第四步：创建任务

**重要**：将任务添加到 `ai-docs/TASKS.json`（不是 PLAN.md）

使用任务管理工具：
```bash
node ${CLAUDE_PLUGIN_ROOT}/scripts/utils/tasks.js add <P0|P1|P2|P3> "描述"
```

**示例**：
```bash
# P0 任务
node ${CLAUDE_PLUGIN_ROOT}/scripts/utils/tasks.js add P0 "实现用户登录功能"

# P1 任务
node ${CLAUDE_PLUGIN_ROOT}/scripts/utils/tasks.js add P1 "优化数据库查询性能"
```

### 第五步：更新项目上下文

**每次分析需求后，更新 `ai-docs/CONTEXT.md`**，记录项目业务信息。

---

## 项目上下文 (CONTEXT.md)

### 内容原则

**应该包含**（业务地图）：
- 项目概述
- 目标用户
- 核心功能
- 项目目标
- 业务约束
- 最新功能更新

**不应该包含**（这些由 TECH.md 和 TODO 管理）：
- 技术实现细节
- 代码结构
- 技术栈信息
- 详细实现步骤

### CONTEXT.md 模板

```markdown
# 项目上下文 (CONTEXT)

## 项目概述

**项目名称**: [项目名称]
**创建时间**: [日期]
**当前版本**: [版本号]

**一句话描述**: [项目的核心价值]

---

## 目标用户

### 主要用户群体
- 用户类型 1: 描述和需求
- 用户类型 2: 描述和需求

### 用户痛点
- 痛点 1
- 痛点 2

---

## 核心功能

### 已实现功能
- 功能 1: 简要描述
- 功能 2: 简要描述

### 开发中功能
- 功能 3: 简要描述 (进行中)
- 功能 4: 简要描述 (待开发)

### 计划功能
- 功能 5: 简要描述 (计划中)

---

## 项目目标

### 短期目标 (1-2 周)
- 目标 1
- 目标 2

### 中期目标 (1-2 月)
- 目标 1
- 目标 2

### 长期愿景
- 描述项目的长期愿景

---

## 业务约束

- 预算约束
- 时间约束
- 资源约束
- 其他约束

---

## 最新功能更新

### [日期] 新增功能
- 功能描述
- 用户价值

### [日期] 优化
- 优化描述
- 影响范围
```

---

## 更新时机

**每次以下操作后，更新 CONTEXT.md**：
1. 新增功能需求
2. 完成功能开发
3. 变更项目目标
4. 调整优先级
5. 重要的业务决策

---

## 用户任务模板

为每个功能创建用户故事：

```markdown
## 用户故事

作为 [用户类型]，我想要 [功能]，以便 [价值]

## 验收标准

- [ ] 标准 1
- [ ] 标准 2
```

---

## 代码实现规范

后续任务代码实现时，根据代码类型选择：
- TypeScript 代码使用 `/typescript`
- Python 代码使用 `/python-development`
- Shell 脚本使用 `/shell-scripting`

---

## 输出结果（最小化输出，避免上下文累积）

**重要**：主对话会累积 subagent 的响应，必须最小化输出。

**❌ 错误示例（输出太多）**：
```
✅ 需求分析完成

识别的功能: 5 个
- P0: 用户认证
- P0: 数据管理
- P1: 数据导出
- P1: 报表生成
- P2: 系统设置

已创建任务: 5 个
- TASK-001: 用户认证 (P0)
- TASK-002: 数据管理 (P0)
...
```

**✅ 正确示例（简洁输出）**：
```
✓ 创建 5 个任务: TASK-001~005
```

或者更简洁：
```
✓
```

**输出原则**：
1. **最小化输出** - 最多一行，包含关键数字
2. **不列出详细内容** - 详细内容在 TASKS.json 中
3. **不输出分析过程** - 只输出最终结果
4. **使用简洁格式** - `✓ 创建 N 个任务` 或 `✓`

---

## 注意事项

1. **优先读取上下文**：每次启动时优先读取 CONTEXT.md，了解项目当前状态
2. **使用 TASKS.json**：任务数据统一在 `TASKS.json`，不要手动编辑
3. **环境变量**：所有脚本都需要 `AI_DOCS_PATH` 环境变量
4. **优先级准确**：根据关键词准确评估优先级
5. **任务描述清晰**：任务描述要具体明确，便于后续开发
6. **维护 CONTEXT.md**：每次分析需求后，更新项目业务上下文
